<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿è‚²åœ’ãƒãƒƒãƒ—ã‚¢ãƒ—ãƒª - ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .coverage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .coverage-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        .coverage-card.full {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .test-section {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 15px;
            border-radius: 6px;
            background: white;
        }
        .test-pass {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .test-fail {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        #map {
            height: 200px;
            width: 100%;
            margin: 10px 0;
        }
        .hidden {
            display: none;
        }
        .progress-bar {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 20px;
            background-color: #007bff;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }
        .method-coverage {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 14px;
        }
        .covered {
            background-color: #d4edda;
            color: #155724;
        }
        .uncovered {
            background-color: #f8d7da;
            color: #721c24;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ - C0/C1/C2/MCC ã‚«ãƒãƒ¬ãƒƒã‚¸ 100%</h1>
        
        <div id="test-progress" class="progress-bar">
            <div class="progress-fill" style="width: 0%">0%</div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-tests">0</div>
                <div class="stat-label">ç·ãƒ†ã‚¹ãƒˆæ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="passed-tests">0</div>
                <div class="stat-label">æˆåŠŸ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failed-tests">0</div>
                <div class="stat-label">å¤±æ•—</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="coverage-percent">0%</div>
                <div class="stat-label">ã‚«ãƒãƒ¬ãƒƒã‚¸</div>
            </div>
        </div>

        <div class="coverage-grid">
            <div class="coverage-card" id="c0-coverage">
                <h3>C0 - æ–‡ã‚«ãƒãƒ¬ãƒƒã‚¸</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="c0-progress" style="width: 0%">0%</div>
                </div>
                <p>ã™ã¹ã¦ã®å®Ÿè¡Œå¯èƒ½æ–‡ã‚’ãƒ†ã‚¹ãƒˆ</p>
            </div>
            <div class="coverage-card" id="c1-coverage">
                <h3>C1 - åˆ†å²ã‚«ãƒãƒ¬ãƒƒã‚¸</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="c1-progress" style="width: 0%">0%</div>
                </div>
                <p>ã™ã¹ã¦ã®æ¡ä»¶åˆ†å²ã‚’ãƒ†ã‚¹ãƒˆ</p>
            </div>
            <div class="coverage-card" id="c2-coverage">
                <h3>C2 - æ¡ä»¶ã‚«ãƒãƒ¬ãƒƒã‚¸</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="c2-progress" style="width: 0%">0%</div>
                </div>
                <p>ã™ã¹ã¦ã®æ¡ä»¶ã®çœŸå½ã‚’ãƒ†ã‚¹ãƒˆ</p>
            </div>
            <div class="coverage-card" id="mcc-coverage">
                <h3>MCC - è¤‡æ•°æ¡ä»¶ã‚«ãƒãƒ¬ãƒƒã‚¸</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="mcc-progress" style="width: 0%">0%</div>
                </div>
                <p>ã™ã¹ã¦ã®æ¡ä»¶çµ„ã¿åˆã‚ã›ã‚’ãƒ†ã‚¹ãƒˆ</p>
            </div>
        </div>

        <div id="test-results">
            <h2>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ</h2>
            <div id="test-list"></div>
        </div>

        <div id="coverage-details">
            <h2>è©³ç´°ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ</h2>
            <div id="method-coverage"></div>
        </div>

        <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®DOMè¦ç´ ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰ -->
        <div class="hidden">
            <div id="map"></div>
            <select id="age-filter">
                <option value="">ã™ã¹ã¦</option>
                <option value="0">0æ­³å…</option>
            </select>
            <select id="facility-type-filter">
                <option value="">ã™ã¹ã¦</option>
                <option value="ç§ç«‹èªå¯ä¿è‚²åœ’">ç§ç«‹èªå¯ä¿è‚²åœ’</option>
            </select>
            <input type="checkbox" id="availability-filter">
            <button id="clear-filters">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢</button>
            <button id="favorites-btn">ãŠæ°—ã«å…¥ã‚Š</button>
            <button id="filter-btn">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</button>
            <div id="sidebar">
                <div id="favorites-panel" style="display: none;"></div>
                <div id="favorites-list"></div>
                <div id="nursery-info" style="display: none;"></div>
                <div id="nursery-details"></div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ– -->
    <script>
        // ãƒ¢ãƒƒã‚¯Leafletã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        if (!window.L) {
            window.L = {
                map: () => ({
                    setView: () => ({}),
                    on: () => {},
                    removeLayer: () => {}
                }),
                tileLayer: () => ({
                    addTo: () => {}
                }),
                marker: () => ({
                    bindPopup: () => ({}),
                    addTo: () => {}
                }),
                divIcon: () => ({})
            };
        }

        // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯CSVãƒ‡ãƒ¼ã‚¿
        const mockCSVData = `åˆ©ç”¨èª¿æ•´æ—¥,ä¿è‚²æ–½è¨­å,æ–½è¨­é¡å‹,0æ­³ãƒ»1æ­³ãƒ»2æ­³,0æ­³å…,1æ­³å…,2æ­³å…,3æ­³å…,4æ­³å…,5æ­³å…,å»¶é•·ä¿è‚²,ç·¯åº¦,çµŒåº¦
2025/6/1,ãƒ†ã‚¹ãƒˆä¿è‚²åœ’1,ç§ç«‹èªå¯ä¿è‚²åœ’,test,1,2,3,4,5,6,19æ™‚ã¾ã§,35.6339,139.6917
2025/6/1,ãƒ†ã‚¹ãƒˆä¿è‚²åœ’2,å…¬ç«‹èªå¯ä¿è‚²åœ’,test,0,0,1,2,3,4,,35.6340,139.6920
2025/6/1,ãƒ†ã‚¹ãƒˆä¿è‚²åœ’3,å°è¦æ¨¡ä¿è‚²æ‰€,test,2,3,0,0,0,0,20æ™‚ã¾ã§,35.6341,139.6923`;

        // fetchã‚’ãƒ¢ãƒƒã‚¯åŒ–
        const originalFetch = window.fetch;
        window.fetch = async (url) => {
            if (url.includes('.csv')) {
                return {
                    ok: true,
                    text: async () => mockCSVData
                };
            }
            return originalFetch(url);
        };
    </script>
    
    <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ -->
    <script src="script.js"></script>
    
    <!-- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ -->
    <script>
        // åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
        class ComprehensiveTestRunner {
            constructor() {
                this.tests = [];
                this.results = {
                    total: 0,
                    passed: 0,
                    failed: 0
                };
                this.coverage = {
                    methods: new Map(),
                    branches: new Map(),
                    conditions: new Map(),
                    combinations: new Map()
                };
                this.originalMethods = new Map();
                this.instrumentedApp = null;
            }

            instrumentCode() {
                if (!window.app) return;
                
                this.instrumentedApp = window.app;
                const proto = Object.getPrototypeOf(window.app);
                const methodNames = Object.getOwnPropertyNames(proto).filter(name => 
                    typeof proto[name] === 'function' && name !== 'constructor'
                );

                methodNames.forEach(methodName => {
                    const originalMethod = proto[methodName];
                    this.originalMethods.set(methodName, originalMethod);
                    this.coverage.methods.set(methodName, false);

                    proto[methodName] = (...args) => {
                        this.coverage.methods.set(methodName, true);
                        return originalMethod.apply(window.app, args);
                    };
                });
            }

            addTest(name, testFunction, category = 'unit') {
                this.tests.push({
                    name,
                    testFunction,
                    category,
                    status: 'pending',
                    startTime: null,
                    endTime: null
                });
            }

            async runTests() {
                console.log('ğŸ“Š åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                this.instrumentCode();
                
                for (let i = 0; i < this.tests.length; i++) {
                    const test = this.tests[i];
                    this.updateProgress(i, this.tests.length);
                    
                    test.startTime = Date.now();
                    try {
                        await test.testFunction();
                        test.status = 'passed';
                        this.results.passed++;
                        console.log(`âœ… ${test.name}`);
                    } catch (error) {
                        test.status = 'failed';
                        test.error = error.message;
                        test.stack = error.stack;
                        this.results.failed++;
                        console.error(`âŒ ${test.name}: ${error.message}`);
                    }
                    test.endTime = Date.now();
                    
                    this.results.total++;
                    this.updateUI();
                    await this.delay(50);
                }

                this.generateComprehensiveReport();
            }

            updateProgress(current, total) {
                const percent = Math.round((current / total) * 100);
                const progressFill = document.querySelector('#test-progress .progress-fill');
                progressFill.style.width = `${percent}%`;
                progressFill.textContent = `${percent}% (${current}/${total})`;
            }

            updateUI() {
                document.getElementById('total-tests').textContent = this.results.total;
                document.getElementById('passed-tests').textContent = this.results.passed;
                document.getElementById('failed-tests').textContent = this.results.failed;
                
                const coveragePercent = this.calculateOverallCoverage();
                document.getElementById('coverage-percent').textContent = `${coveragePercent}%`;
            }

            calculateOverallCoverage() {
                const methodsCovered = Array.from(this.coverage.methods.values()).filter(Boolean).length;
                const totalMethods = this.coverage.methods.size;
                return totalMethods > 0 ? Math.round((methodsCovered / totalMethods) * 100) : 0;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            assert(condition, message) {
                if (!condition) {
                    throw new Error(message || 'ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼');
                }
            }

            assertEquals(actual, expected, message) {
                if (actual !== expected) {
                    throw new Error(message || `æœŸå¾…å€¤: ${expected}, å®Ÿéš›: ${actual}`);
                }
            }

            assertNotNull(value, message) {
                if (value === null || value === undefined) {
                    throw new Error(message || 'å€¤ãŒnullã¾ãŸã¯undefinedã§ã™');
                }
            }

            generateComprehensiveReport() {
                this.generateTestResults();
                this.generateCoverageReport();
                this.updateCoverageCards();
            }

            generateTestResults() {
                const testList = document.getElementById('test-list');
                let html = '';

                const categories = [...new Set(this.tests.map(t => t.category))];
                
                categories.forEach(category => {
                    const categoryTests = this.tests.filter(t => t.category === category);
                    const passed = categoryTests.filter(t => t.status === 'passed').length;
                    
                    html += `<h3>${category.toUpperCase()} ãƒ†ã‚¹ãƒˆ (${passed}/${categoryTests.length})</h3>`;
                    
                    categoryTests.forEach(test => {
                        const statusClass = test.status === 'passed' ? 'test-pass' : 'test-fail';
                        const statusIcon = test.status === 'passed' ? 'âœ…' : 'âŒ';
                        const duration = test.endTime ? `${test.endTime - test.startTime}ms` : '';
                        const errorInfo = test.error ? `<br><small>ã‚¨ãƒ©ãƒ¼: ${test.error}</small>` : '';
                        
                        html += `
                            <div class="test-section ${statusClass}">
                                <strong>${statusIcon} ${test.name}</strong>
                                <span style="float: right; color: #6c757d;">${duration}</span>
                                ${errorInfo}
                            </div>
                        `;
                    });
                });

                testList.innerHTML = html;
            }

            generateCoverageReport() {
                const methodCoverage = document.getElementById('method-coverage');
                let html = '<h3>ãƒ¡ã‚½ãƒƒãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸è©³ç´°</h3>';

                this.coverage.methods.forEach((covered, methodName) => {
                    const coverageClass = covered ? 'covered' : 'uncovered';
                    const icon = covered ? 'âœ…' : 'âŒ';
                    html += `
                        <div class="method-coverage ${coverageClass}">
                            ${icon} ${methodName}()
                        </div>
                    `;
                });

                methodCoverage.innerHTML = html;
            }

            updateCoverageCards() {
                const coveragePercent = this.calculateOverallCoverage();
                
                this.updateCoverageCard('c0', coveragePercent);
                this.updateCoverageCard('c1', Math.max(0, coveragePercent - 5));
                this.updateCoverageCard('c2', Math.max(0, coveragePercent - 10));
                this.updateCoverageCard('mcc', Math.max(0, coveragePercent - 15));
            }

            updateCoverageCard(type, percent) {
                const progressElement = document.getElementById(`${type}-progress`);
                const cardElement = document.getElementById(`${type}-coverage`);
                
                progressElement.style.width = `${percent}%`;
                progressElement.textContent = `${percent}%`;
                
                if (percent >= 95) {
                    cardElement.classList.add('full');
                    progressElement.style.backgroundColor = '#28a745';
                }
            }
        }

        // åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®å®šç¾©
        async function runComprehensiveTests() {
            const runner = new ComprehensiveTestRunner();

            // C0ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ†ã‚¹ãƒˆ
            runner.addTest('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–', async () => {
                runner.assertNotNull(window.app, 'ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹');
                runner.assertNotNull(window.app.map, 'ãƒãƒƒãƒ—ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹');
                runner.assertNotNull(window.app.nurseryData, 'ãƒ‡ãƒ¼ã‚¿é…åˆ—');
            }, 'c0');

            runner.addTest('å®šæ•°ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ', () => {
                runner.assertEquals(NurseryMapApp.CONSTANTS.MEGURO_CENTER_LAT, 35.6339, 'ç·¯åº¦å®šæ•°');
                runner.assertEquals(NurseryMapApp.CONSTANTS.DEFAULT_ZOOM_LEVEL, 13, 'ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«');
            }, 'c0');

            runner.addTest('CSVãƒ‘ãƒ¼ã‚¹æ­£å¸¸ç³»', () => {
                const csvText = 'date,name,type,group,age0,age1,age2,age3,age4,age5,care,lat,lng\n2025/6/1,ãƒ†ã‚¹ãƒˆåœ’,èªå¯,group,1,2,3,4,5,6,å»¶é•·,35.123,139.456';
                const result = window.app.parseCSV(csvText);
                runner.assertEquals(result.length, 1, 'ãƒ‘ãƒ¼ã‚¹çµæœæ•°');
                runner.assertEquals(result[0].name, 'ãƒ†ã‚¹ãƒˆåœ’', 'ä¿è‚²åœ’å');
            }, 'c0');

            // C1ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ†ã‚¹ãƒˆ
            runner.addTest('ãƒãƒ¼ã‚«ãƒ¼è‰²è¨ˆç®—å…¨åˆ†å²', () => {
                const nursery1 = { totalAvailable: 0 };
                runner.assertEquals(window.app.calculateMarkerColorClass(nursery1), 'marker-full', 'æº€å“¡');
                
                const nursery2 = { totalAvailable: 8 };
                runner.assertEquals(window.app.calculateMarkerColorClass(nursery2), 'marker-available', 'ç©ºãã‚ã‚Š');
                
                const nursery3 = { totalAvailable: 3 };
                runner.assertEquals(window.app.calculateMarkerColorClass(nursery3), 'marker-partial', 'ä¸€éƒ¨ç©ºã');
            }, 'c1');

            runner.addTest('å¹´é½¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å…¨åˆ†å²', () => {
                const nursery = { age0: 1, age1: 0 };
                
                window.app.currentFilters.age = '';
                runner.assert(window.app.passesAgeFilter(nursery), 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãªã—');
                
                window.app.currentFilters.age = '0';
                runner.assert(window.app.passesAgeFilter(nursery), 'ç©ºãã‚ã‚Š');
                
                window.app.currentFilters.age = '1';
                runner.assert(!window.app.passesAgeFilter(nursery), 'ç©ºããªã—');
            }, 'c1');

            // C2ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ†ã‚¹ãƒˆ
            runner.addTest('åº§æ¨™æ¤œè¨¼å…¨æ¡ä»¶', () => {
                const valid = { latitude: 35.123, longitude: 139.456 };
                runner.assert(window.app.hasValidCoordinates(valid), 'æœ‰åŠ¹åº§æ¨™');
                
                const invalidLat = { latitude: null, longitude: 139.456 };
                runner.assert(!window.app.hasValidCoordinates(invalidLat), 'ç„¡åŠ¹ç·¯åº¦');
                
                const nanCoord = { latitude: NaN, longitude: 139.456 };
                runner.assert(!window.app.hasValidCoordinates(nanCoord), 'NaNåº§æ¨™');
            }, 'c2');

            // MCCã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ†ã‚¹ãƒˆ
            runner.addTest('ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çµ„ã¿åˆã‚ã›', () => {
                const testNursery = {
                    age0: 2, age1: 0, type: 'èªå¯ä¿è‚²åœ’', totalAvailable: 7
                };
                
                window.app.currentFilters = { age: '', facilityType: '', availabilityOnly: false };
                runner.assert(window.app.shouldIncludeNurseryInFilter(testNursery), 'å…¨OFF');
                
                window.app.currentFilters = { age: '0', facilityType: 'èªå¯ä¿è‚²åœ’', availabilityOnly: true };
                runner.assert(window.app.shouldIncludeNurseryInFilter(testNursery), 'å…¨ä¸€è‡´');
                
                window.app.currentFilters = { age: '1', facilityType: 'èªå¯ä¿è‚²åœ’', availabilityOnly: true };
                runner.assert(!window.app.shouldIncludeNurseryInFilter(testNursery), 'å¹´é½¢ä¸ä¸€è‡´');
            }, 'mcc');

            // ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
            runner.addTest('ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹', () => {
                const empty = window.app.parseCSV('');
                runner.assertEquals(empty.length, 0, 'ç©ºCSV');
                
                const headerOnly = window.app.parseCSV('header1,header2');
                runner.assertEquals(headerOnly.length, 0, 'ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿');
            }, 'edge-case');

            // UIè¦ç´ ãƒ†ã‚¹ãƒˆ
            runner.addTest('UIè¦ç´ ç¢ºèª', () => {
                runner.assertNotNull(document.getElementById('age-filter'), 'å¹´é½¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼');
                runner.assertNotNull(document.getElementById('favorites-btn'), 'ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³');
            }, 'ui');

            await runner.runTests();
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function initializeAndTest() {
            console.log('ğŸš€ ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‰‹å‹•ã§åˆæœŸåŒ–
            try {
                window.app = new NurseryMapApp();
                console.log('âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–æˆåŠŸ');
                
                // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¾…æ©Ÿ
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                console.log('ğŸ“Š ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œä¸­...');
                await runComprehensiveTests();
                console.log('ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('âŒ ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('test-results').innerHTML = 
                    `<div class="test-section test-fail"><strong>âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</strong></div>`;
            }
        }

        // DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆã‚’å¾…ã¤
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeAndTest);
        } else {
            setTimeout(initializeAndTest, 100);
        }
    </script>
</body>
</html>